\chapter{CAP√çTULO 4: DISE√ëO DE LA SOLUCI√ìN}

\section{4.1. Introducci√≥n}
Este cap√≠tulo detalla el dise√±o t√©cnico y arquitect√≥nico del "Asistente Virtual para la Preparaci√≥n del Examen PMP". Se describe la estructura l√≥gica y f√≠sica del sistema, los componentes de software desarrollados, los modelos de datos implementados y los flujos de interacci√≥n que permiten el funcionamiento de las capacidades de inteligencia artificial generativa. El dise√±o se ha orientado a crear una soluci√≥n escalable, modular y mantenible, priorizando la experiencia del usuario y la precisi√≥n pedag√≥gica.

\section{4.2. Arquitectura General del Sistema}
La arquitectura del sistema ha sido dise√±ada siguiendo los principios modernos de la ingenier√≠a de software para aplicaciones web distribuidas, adoptando un enfoque \textbf{Serverless} y \textbf{Jamstack} (JavaScript, APIs, and Markup). Este paradigma arquitect√≥nico permite desacoplar completamente la capa de presentaci√≥n (frontend) de la l√≥gica de negocio y los datos (backend), lo que resulta en un sistema altamente modular, escalable y seguro.

La elecci√≥n de esta arquitectura responde a la necesidad de ofrecer una experiencia de usuario fluida y de baja latencia, crucial para un entorno de estudio interactivo, minimizando al mismo tiempo la carga operativa de administraci√≥n de servidores. Al utilizar servicios gestionados y funciones sin servidor ("serverless functions"), el sistema puede escalar autom√°ticamente seg√∫n la demanda de los usuarios, optimizando costos y recursos computacionales. Adem√°s, este enfoque facilita la integraci√≥n continua y el despliegue r√°pido de nuevas funcionalidades pedag√≥gicas.

\subsection{4.2.1. Diagrama de Arquitectura de Alto Nivel}
El sistema se estructura en cuatro capas l√≥gicas claramente diferenciadas, cada una con responsabilidades espec√≠ficas y canales de comunicaci√≥n definidos:

\begin{enumerate}
\item \textbf{Capa de Presentaci√≥n (Frontend - Client Side):}
    Esta capa es responsable de toda la interacci√≥n con el usuario final. Desarrollada con \textbf{React} y ejecutada principalmente en el navegador del usuario, se encarga de renderizar la interfaz gr√°fica, gestionar el estado local de la sesi√≥n de estudio (como las respuestas seleccionadas en el simulador o el historial de chat visible) y capturar los eventos de entrada. Gracias al modelo de "hidrataci√≥n" de React, la aplicaci√≥n ofrece una experiencia de "Single Page Application" (SPA), donde la navegaci√≥n entre secciones es instant√°nea y no requiere recargas completas de p√°gina.

\item \textbf{Capa de Aplicaci√≥n y Orquestaci√≥n (Backend - Server Side):}
    Implementada mediante \textbf{Next.js API Routes}, esta capa act√∫a como el cerebro l√≥gico del sistema. Funciona como un conjunto de microservicios ligeros que se ejecutan bajo demanda. Sus responsabilidades incluyen:
\end{enumerate}
\begin{itemize}
\item Validaci√≥n de seguridad y autenticaci√≥n de las peticiones entrantes.
\item Orquestaci√≥n del flujo de datos entre el cliente, la base de datos y el servicio de IA.
\item Construcci√≥n de contextos (prompts) enriquecidos para el modelo de lenguaje, inyectando informaci√≥n pedag√≥gica espec√≠fica seg√∫n el modo de estudio seleccionado.
\item Gesti√≥n de la l√≥gica de negocio cr√≠tica, como el c√°lculo de puntajes de ex√°menes o la generaci√≥n din√°mica de preguntas.

\end{itemize}
\begin{enumerate}
\item \textbf{Capa de Datos y Persistencia (Data Layer):}
    Esta capa garantiza la integridad y disponibilidad de la informaci√≥n a largo plazo. Se utiliza un servicio de \textbf{Backend-as-a-Service (BaaS)} que provee:
\end{enumerate}
\begin{itemize}
\item Una base de datos relacional para almacenar perfiles de usuarios, historiales de chat y registros de simulaciones.
\item Un sistema de autenticaci√≥n seguro (JWT) que gestiona el ciclo de vida de las sesiones de usuario.
\item Reglas de seguridad a nivel de fila (Row Level Security) que aseguran que cada estudiante solo pueda acceder a sus propios datos.

\end{itemize}
\begin{enumerate}
\item \textbf{Capa de Inteligencia Cognitiva (AI Service Layer):}
    Es el componente externo que dota de "inteligencia" al asistente. El sistema consume la API de un Modelo de Lenguaje Grande (LLM) de √∫ltima generaci√≥n. Esta capa no almacena estado de la aplicaci√≥n; funciona como un motor de procesamiento de lenguaje natural puro, recibiendo contexto y devolviendo explicaciones, preguntas o feedback pedag√≥gico en tiempo real.

\end{enumerate}
\begin{figure}[H]
\centering
% \includegraphics[width=0.8\textwidth]{placeholder.png}
\caption{Diagrama de arquitectura de alto nivel}
\label{figura\_4.1}
\end{figure}
\textit{\textit{Sugerencia: Incluir un diagrama de bloques detallado mostrando: Cliente Web (Navegador) -> Next.js (Vercel) -> API Routes (Node.js) -> PocketBase (SQLite) / Google Gemini API.}}

\subsection{4.2.2. Stack Tecnol√≥gico Detallado}
Para materializar la arquitectura propuesta, se ha realizado una selecci√≥n rigurosa de tecnolog√≠as, priorizando aquellas que ofrecen un equilibrio √≥ptimo entre rendimiento, mantenibilidad y soporte de la comunidad (ecosistema).

\subsubsection{A. Core Framework y Lenguaje}
\begin{itemize}
\item \textbf{Next.js 16.1 (App Router):} Se utiliza la √∫ltima versi√≥n estable del framework full-stack de React. La adopci√≥n del "App Router" permite aprovechar capacidades avanzadas como los \textbf{React Server Components (RSC)} y el \textbf{Streaming SSR}. Esto significa que gran parte del HTML se genera en el servidor de manera incremental, reduciendo el tama√±o del paquete JavaScript que el usuario debe descargar y mejorando dr√°sticamente el tiempo de carga inicial (First Contentful Paint).
\item \textbf{TypeScript:} Todo el c√≥digo base est√° escrito en TypeScript. El tipado est√°tico fuerte es fundamental en este proyecto para garantizar que las estructuras de datos complejas (como los objetos JSON de las preguntas del examen PMP o las respuestas de la API de IA) se manejen correctamente, previniendo errores en tiempo de ejecuci√≥n "undefined is not a function" antes de que ocurran.

\end{itemize}
\subsubsection{B. Interfaz de Usuario y Experiencia (UX)}
\begin{itemize}
\item \textbf{React 19:} La biblioteca de interfaz de usuario subyacente. Se aprovechan sus nuevos hooks y primitivas para la gesti√≥n eficiente del estado y las transiciones concurrentes.
\item \textbf{Tailwind CSS 4:} Framework de estilos "utility-first". Permite construir interfaces consistentes y adaptables (responsive) directamente desde el HTML. La versi√≥n 4 introduce un motor de compilaci√≥n JIT (Just-in-Time) de nueva generaci√≥n, ultrarr√°pido y con detecci√≥n autom√°tica de clases.
\item \textbf{Framer Motion:} Biblioteca utilizada para las animaciones de la interfaz (transiciones entre preguntas, aparici√≥n de mensajes de chat, confeti de celebraci√≥n), proporcionando una sensaci√≥n de fluidez y modernidad esencial para mantener el compromiso del usuario (engagement).
\item \textbf{Lucide React:} Conjunto de iconos vectoriales SVG ligeros y consistentes visualmente, utilizados para mejorar la usabilidad de la navegaci√≥n y los controles.

\end{itemize}
\subsubsection{C. Backend y Base de Datos}
\begin{itemize}
\item \textbf{PocketBase:} Una soluci√≥n de backend ultra-port√°til escrita en \textbf{Go}. A diferencia de bases de datos tradicionales como PostgreSQL que requieren una administraci√≥n compleja, PocketBase utiliza \textbf{SQLite} en modo WAL (Write-Ahead Logging) embebido, lo que ofrece un rendimiento excepcional para el volumen de lectura/escritura esperado en una aplicaci√≥n educativa (miles de operaciones por segundo). Su API en tiempo real permite futuras expansiones.
\item \textbf{LangChain.js:} Framework de orquestaci√≥n para LLMs. Act√∫a como una capa de abstracci√≥n sobre la API de Gemini. Permite cambiar de modelo de IA con cambios m√≠nimos en el c√≥digo, y facilita la gesti√≥n de cadenas de pensamiento y la estructuraci√≥n de las salidas (parsers) para asegurar que la IA siempre responda en el formato esperado (por ejemplo, JSON v√°lido para las simulaciones).

\end{itemize}
\subsubsection{D. Motor de Inteligencia Artificial}
\begin{itemize}
\item \textbf{Google Gemini 3.0 Flash (Preview):} Se ha seleccionado el modelo m√°s reciente y experimental de Google para aprovechar sus capacidades superiores de razonamiento y velocidad. Esta versi√≥n "Flash" est√° optimizada para respuestas de latencia ultra baja, esencial para mantener una conversaci√≥n fluida en tiempo real, mientras mantiene una ventana de contexto masiva que permite analizar documentos extensos del PMBOK sin perder coherencia.

\end{itemize}
\section{4.3. Componentes Principales del Asistente Virtual}
El sistema ha sido construido mediante una arquitectura modular basada en componentes reutilizables, ubicados principalmente en \texttt{app/components}. Esta estrategia no solo facilita el desarrollo paralelo y las pruebas unitarias, sino que tambi√©n asegura que el mantenimiento futuro sea menos propenso a errores en cascada.

\subsection{4.3.1. Estructura del Proyecto (Frontend)}
El frontend de la aplicaci√≥n, desarrollado sobre \textbf{Next.js}, aprovecha la distinci√≥n entre \textit{Server Components} (para renderizado est√°tico y acceso a datos seguro) y \textit{Client Components} (para interactividad).

\subsubsection{A. Layout y Navegaci√≥n (`Sidebar` y `Dashboard`)}
\begin{itemize}
\item \textbf{Componente \texttt{Sidebar}:}
    Implementado como un componente de cliente (\texttt{'use client'}), gestiona la navegaci√≥n global de la aplicaci√≥n. Mantiene el estado de la ruta activa y colapsa/expande el men√∫ en dispositivos m√≥viles para garantizar la responsividad. Utiliza iconos vectoriales de la librer√≠a \texttt{lucide-react} para ofrecer pistas visuales claras. Adem√°s, integra el control de cierre de sesi√≥n, que invoca directamente al cliente de autenticaci√≥n de PocketBase para limpiar el almacenamiento local (LocalStorage) y redirigir al login.

\item \textbf{Componente \texttt{Dashboard}:}
    Act√∫a como el centro de mando del estudiante. Al cargarse, realiza consultas as√≠ncronas a la colecci√≥n \texttt{user\_progress} y \texttt{simulations} para calcular m√©tricas en tiempo real. Visualiza:
\item \textbf{Nivel de Usuario:} Una barra de progreso animada con \texttt{framer-motion} que muestra la experiencia (XP) actual relativa al siguiente nivel.
\item \textbf{Racha de Estudio:} L√≥gica que compara la fecha de la √∫ltima actividad registrada con la fecha actual para determinar la continuidad del h√°bito de estudio.
\item \textbf{Resumen de Dominios:} Tarjetas informativas que desglosan el rendimiento por √°reas del PMBOK (Personas, Procesos, Entorno de Negocio).
\item \textbf{Historial de Simulaciones:} Una lista filtrable de los ex√°menes realizados, permitiendo retomar los que est√°n "en progreso" o revisar los "completados".

\end{itemize}
\subsubsection{B. M√≥dulo de Chat Inteligente (`ChatArea`)}
Este componente representa el n√∫cleo interactivo de la soluci√≥n y es t√©cnicamente el m√°s complejo del frontend.
\begin{itemize}
\item \textbf{Gesti√≥n de Estado Avanzada:} Utiliza \texttt{useRef} para mantener referencias mutables al contenedor de scroll (logrando un auto-scroll suave cuando llegan nuevos mensajes) y \texttt{useState} para gestionar la cola de mensajes y el estado de "pensando" (loading state) del asistente.
\item \textbf{Streaming de Respuesta:} La comunicaci√≥n con el backend utiliza flujos de datos (\texttt{streams}). El cliente procesa los chunks de texto a medida que llegan desde la API de Gemini, reduciendo la percepci√≥n de latencia y mostrando la respuesta car√°cter por car√°cter.
\item \textbf{Inyecci√≥n de Contexto Din√°mico:} El componente permite al usuario seleccionar "Modos" (Socr√°tico, Simulaci√≥n, Workshop, etc.). Al cambiar el modo, se actualiza un estado que se env√≠a como metadato en el payload de la API, alterando el comportamiento de la IA sin recargar la p√°gina.
\item \textbf{Renderizado Markdown:} Los mensajes recibidos se procesan a trav√©s de \texttt{react-markdown}. Esto permite que el asistente estructure sus explicaciones con listas, tablas, negritas y bloques de c√≥digo con resaltado de sintaxis.

\end{itemize}
\subsubsection{C. Simulador de Examen (`ExamSimulator`)}
Dise√±ado para replicar fielmente las condiciones del examen de certificaci√≥n PMP.
\begin{itemize}
\item \textbf{Motor de Preguntas:} Este componente maneja un array de objetos JSON que representan las preguntas. Puede operar en dos modos:
\end{itemize}
\begin{enumerate}
\item \textbf{Carga Est√°tica/Hist√≥rica:} Recupera un examen existente desde PocketBase (colecci√≥n \texttt{simulations}) para continuar una sesi√≥n previa.
\item \textbf{Generaci√≥n Din√°mica:} Invoca a la API de IA (\texttt{/api/simulation/generate}) para crear un set de preguntas √∫nico basado en un tema espec√≠fico y una cantidad definida (ej. 10, 45, 90 preguntas).
\end{enumerate}
\begin{itemize}
\item \textbf{Control de Tiempo y Navegaci√≥n:} Implementa un temporizador decreciente (\texttt{useEffect} con \texttt{setInterval}) que alerta al usuario cuando el tiempo se agota. La navegaci√≥n entre preguntas se gestiona mediante un √≠ndice de estado.
\item \textbf{L√≥gica de Evaluaci√≥n:} Al finalizar, compara las respuestas del usuario (\texttt{selectedOptions}) con las \texttt{correctAnswer} almacenadas. Calcula el porcentaje de aciertos y actualiza el registro en la base de datos, marcando el examen como \texttt{completed} y guardando el puntaje final.

\end{itemize}
\subsubsection{D. Componentes Auxiliares de UX}
\begin{itemize}
\item \textbf{\texttt{OnboardingModal}:} Un asistente tipo "wizard" de 4 pasos que se presenta a los nuevos usuarios, explicando la metodolog√≠a de estudio y las funcionalidades principales.
\item \textbf{\texttt{LevelCompletedModal}:} Un componente de celebraci√≥n que se activa cuando el usuario alcanza el 100\% de progreso en un nivel. Utiliza animaciones de confeti y transiciones de entrada para proporcionar refuerzo positivo inmediato.

\end{itemize}
\begin{figure}[H]
\centering
% \includegraphics[width=0.8\textwidth]{placeholder.png}
\caption{Componentes de la Interfaz de Usuario}
\label{figura\_4.2}
\end{figure}
\textit{\textit{Sugerencia: Captura de pantalla compuesta mostrando: 1) El Dashboard con m√©tricas, 2) Una sesi√≥n de Chat activa con streaming de texto, y 3) La interfaz del Simulador con una pregunta de selecci√≥n m√∫ltiple.}}

\subsection{4.3.1.E Estrategias de Navegaci√≥n y Modos de Estudio}
El Dashboard principal act√∫a como un controlador de estado que adapta la experiencia de aprendizaje a trav√©s de cuatro modos de visualizaci√≥n distintos, gestionados por el estado \texttt{viewMode}. Esta flexibilidad permite que la aplicaci√≥n sirva tanto a estudiantes novatos que necesitan estructura como a expertos que buscan pr√°ctica espec√≠fica.

\begin{enumerate}
\item \textbf{Modo Guiado (üó∫Ô∏è):}
\end{enumerate}
\begin{itemize}
\item \textbf{Enfoque:} Gamificaci√≥n y Progresi√≥n Lineal.
\item \textbf{Comportamiento:} Es la vista predeterminada. Presenta el contenido organizado en "Mundos" (Fases) y "Niveles". Implementa una l√≥gica de bloqueo estricta donde un nivel solo se habilita (\texttt{isLocked: false}) cuando el inmediatamente anterior ha sido marcado como completado en la colecci√≥n \texttt{user\_progress}.
\item \textbf{Objetivo:} Garantizar que el estudiante construya su conocimiento sobre bases s√≥lidas antes de avanzar a conceptos complejos.

\end{itemize}
\begin{enumerate}
\item \textbf{Modo Desbloqueado (üîì):}
\end{enumerate}
\begin{itemize}
\item \textbf{Enfoque:} Referencia y Consulta.
\item \textbf{Comportamiento:} Utiliza la misma interfaz visual de mapas y mundos que el Modo Guiado, pero elimina todas las restricciones de acceso. Todos los niveles son accesibles instant√°neamente.
\item \textbf{Objetivo:} Permitir a usuarios avanzados o repetidores navegar libremente para reforzar √°reas espec√≠ficas sin la fricci√≥n de tener que "desbloquear" contenido ya conocido.

\end{itemize}
\begin{enumerate}
\item \textbf{Modo Libre (‚ôæÔ∏è):}
\end{enumerate}
\begin{itemize}
\item \textbf{Enfoque:} Herramientas de IA a la Carta.
\item \textbf{Comportamiento:} Reemplaza completamente la visualizaci√≥n del mapa de niveles por un men√∫ de tarjetas ("Grid Layout"). Ofrece 9 herramientas especializadas dise√±adas para cubrir diferentes estilos de aprendizaje y necesidades espec√≠ficas:
\item \textbf{Modo Est√°ndar:} El asistente cl√°sico. Proporciona preguntas y respuestas directas sobre cualquier tema del PMBOK. Es ideal para resolver dudas r√°pidas y obtener definiciones precisas.
\item \textbf{Simulaci√≥n de Crisis:} Un roleplay inmersivo donde la IA act√∫a como un stakeholder dif√≠cil, un miembro del equipo conflictivo o un patrocinador exigente. El usuario debe actuar como Project Manager para resolver la situaci√≥n aplicando habilidades blandas y t√©cnicas.
\item \textbf{Taller de Entregables:} Una herramienta de creaci√≥n guiada paso a paso. Ayuda al usuario a redactar documentos clave como el Project Charter, la Matriz de Riesgos o el Plan de Gesti√≥n de Comunicaciones, asegurando que se incluyan todos los componentes est√°ndar.
\item \textbf{Examen R√°pido:} Genera una serie corta de preguntas tipo PMP para poner a prueba el conocimiento del usuario. Ofrece feedback inmediato y explicaciones detalladas para cada opci√≥n de respuesta (correcta e incorrectas).
\item \textbf{Tutor Socr√°tico:} Dise√±ado para profundizar en conceptos complejos. En lugar de dar la respuesta directa, la IA gu√≠a al usuario mediante una serie de preguntas reflexivas para que √©l mismo descubra la soluci√≥n y construya su conocimiento.
\item \textbf{Debate (Abogado del Diablo):} Un ejercicio de argumentaci√≥n donde la IA adopta deliberadamente una postura pol√©mica o incorrecta sobre un tema de gesti√≥n de proyectos. El usuario debe convencer a la IA utilizando argumentos basados en los est√°ndares del PMBOK y el C√≥digo de √âtica.
\item \textbf{Caso de Estudio:} Presenta escenarios complejos y multifac√©ticos de proyectos. El usuario act√∫a como consultor externo para diagnosticar problemas ra√≠z (root cause analysis) y proponer un plan de acci√≥n correctivo integral.
\item \textbf{Expl√≠camelo como a un ni√±o (ELI5):} Simplifica conceptos densos o abstractos utilizando analog√≠as cotidianas y lenguaje sencillo. Es especialmente √∫til para entender la esencia de procesos complejos antes de estudiar los detalles t√©cnicos.
\item \textbf{Entrenador de F√≥rmulas:} Se centra exclusivamente en la parte cuantitativa del examen. Genera ejercicios pr√°cticos sobre Gesti√≥n del Valor Ganado (EVM), an√°lisis de Ruta Cr√≠tica (CPM) y proyecciones financieras, ense√±ando a interpretar los resultados num√©ricos.
\item \textbf{Objetivo:} Ofrecer acceso directo a las capacidades del LLM fuera del contexto de un "nivel" espec√≠fico, ideal para sesiones de estudio auto-dirigidas o exploraci√≥n de conceptos abstractos.

\end{itemize}
\begin{enumerate}
\item \textbf{Simulaci√≥n Examen (üéì):}
\end{enumerate}
\begin{itemize}
\item \textbf{Enfoque:} Evaluaci√≥n y M√©tricas.
\item \textbf{Comportamiento:} Transforma el Dashboard en un centro de an√°lisis de datos. Muestra gr√°ficos de rendimiento acumulado, desglose de aciertos por dominio (Personas, Procesos, Entorno) y permite lanzar generadores de ex√°menes de longitud variable (simulacros de 45 a 180 preguntas).
\item \textbf{Objetivo:} Validar la preparaci√≥n del estudiante bajo condiciones controladas y proporcionar feedback cuantitativo sobre su preparaci√≥n real para el examen.

\end{itemize}
\subsection{4.3.2. Servicios de Backend (API Routes)}
Las API Routes de Next.js act√∫an como una capa de abstracci√≥n segura (Backend-for-Frontend) que oculta las credenciales de servicios terceros y centraliza la l√≥gica de negocio.

\subsubsection{A. Ruta de Chat (`/api/chat`)}
Esta ruta orquesta la interacci√≥n con el modelo de lenguaje Google Gemini.
\begin{itemize}
\item \textbf{Validaci√≥n:} Verifica que la solicitud contenga un array de mensajes v√°lido y un modo de operaci√≥n soportado.
\item \textbf{Integraci√≥n con LangChain:} Utiliza la librer√≠a \texttt{LangChain.js} para instanciar el modelo \texttt{ChatGoogleGenerativeAI} configurado con el modelo \textbf{gemini-3-flash-preview}.
\item \textbf{Ingenier√≠a de Prompts (System Prompting):} La ruta selecciona din√°micamente el "Prompt del Sistema" bas√°ndose en el par√°metro \texttt{mode} recibido:
\item \textbf{Est√°ndar:} Tutor experto en PMBOK 7ma Edici√≥n.
\item \textbf{Simulaci√≥n:} Stakeholder o miembro del equipo en un escenario de crisis (Roleplay).
\item \textbf{Workshop:} Facilitador senior que gu√≠a en la creaci√≥n de entregables (Project Charter, WBS, etc.).
\item \textbf{Socr√°tico:} Profesor que responde solo con preguntas para fomentar el an√°lisis.
\item \textbf{Quiz:} Examinador oficial que lanza preguntas situacionales dif√≠ciles.
\item \textbf{Manejo de Streaming:} La respuesta del modelo se canaliza para devolver un flujo de datos continuo al cliente, permitiendo tiempos de respuesta percibidos casi instant√°neos.

\end{itemize}
\subsubsection{B. Ruta de Generaci√≥n de Simulaci√≥n (`/api/simulation/generate`)}
Esta ruta es cr√≠tica para la funcionalidad de generaci√≥n infinita de contenido.
\begin{itemize}
\item \textbf{Prompt de Estructura Estricta (JSON Mode):} Se instruye al modelo Gemini para que act√∫e como un generador de datos estructurados. El prompt exige que la salida sea estrictamente un array JSON v√°lido de objetos \texttt{Question}, definiendo campos como \texttt{text}, \texttt{options}, \texttt{correctAnswer} y \texttt{explanation}.
\item \textbf{Parsing y Validaci√≥n:} La respuesta cruda de la IA se limpia y parsea. Aunque se conf√≠a en la capacidad del modelo, se implementan bloques \texttt{try-catch} para manejar posibles errores de formato JSON ("alucinaciones sint√°cticas") y asegurar que el frontend siempre reciba datos consumibles.

\end{itemize}
\subsection{4.3.3. Modelo de Datos (PocketBase)}
La base de datos se ha dise√±ado utilizando el esquema relacional ligero de PocketBase. A continuaci√≥n se detallan las colecciones y sus estructuras de datos.

\begin{table}[H]
\centering
% \includegraphics[width=0.8\textwidth]{placeholder.png}
\caption{Esquema de Base de Datos Detallado}
\label{tabla\_4.1}
\end{table}
\textit{\textit{Sugerencia: Tabla t√©cnica describiendo tipos de datos y relaciones.}}

\begin{table}[H]
\centering
\small
\begin{tabular}{lllll}
\hline
\textbf{Colecci√≥n} & \textbf{Tipo} & \textbf{Campos Clave} & \textbf{Relaciones} & \textbf{Descripci√≥n} \\
\hline
\textbf{users} & Auth & \texttt{id}, \texttt{username}, \texttt{email}, \texttt{avatar}, \texttt{name} & - & Colecci√≥n del sistema para gesti√≥n de identidad. Almacena tambi√©n preferencias de UI. \\
\hline
\textbf{user\_progress} & Base & \texttt{user\_id} (relation), \texttt{level} (int), \texttt{xp} (int), \texttt{streak\_days} (int), \texttt{last\_login} (date) & 1:1 con \texttt{users} & Almacena la gamificaci√≥n y m√©tricas acumuladas del estudiante. \\
\hline
\textbf{chats} & Base & \texttt{id}, \texttt{user\_id} (relation), \texttt{title} (text), \texttt{mode} (select), \texttt{created} (date) & N:1 con \texttt{users} & Cabecera de una sesi√≥n de conversaci√≥n. Permite listar el historial en el sidebar. \\
\hline
\textbf{messages} & Base & \texttt{chat\_id} (relation), \texttt{role} (select: 'user'\textbackslash{} & 'assistant'), \texttt{content} (text), \texttt{created} (date) & N:1 con \texttt{chats} & Almacena cada interacci√≥n individual. Indexado por \texttt{chat\_id} para recuperaci√≥n r√°pida. \\
\hline
\textbf{simulations} & Base & \texttt{user\_id} (relation), \texttt{score} (int), \texttt{questions} (json), \texttt{answers} (json), \texttt{status} (select: 'in\_progress'\textbackslash{} & 'completed') & N:1 con \texttt{users} & Almacena ex√°menes completos. El campo \texttt{questions} guarda el array completo de preguntas generadas para mantener la integridad hist√≥rica del examen realizado. \\
\hline
\end{tabular}
\end{table}

\begin{itemize}
\item \textbf{Seguridad a Nivel de Fila (RLS):}
    Todas las colecciones tienen reglas de API configuradas para garantizar la privacidad.
\item \texttt{List/View Rule}: \texttt{user\_id = @request.auth.id} (El usuario solo ve sus propios registros).
\item \texttt{Create/Update Rule}: \texttt{user\_id = @request.auth.id} (El usuario solo puede crear/modificar datos asociados a su ID).
\item Esto asegura que, incluso si un atacante intentara acceder a la API directamente, no podr√≠a leer datos de otros estudiantes.

\end{itemize}
\section{4.4. Flujos de Interacci√≥n y Procesos}
El dise√±o din√°mico de la soluci√≥n se detalla a trav√©s de los flujos de datos que ocurren entre el usuario, el sistema y los servicios externos. A continuaci√≥n, se describen los algoritmos y secuencias de operaci√≥n para los casos de uso principales.

\subsection{4.4.1. Flujo de Autenticaci√≥n y Onboarding}
Este proceso es la puerta de entrada al sistema y garantiza que cada sesi√≥n de estudio est√© personalizada y segura.
\begin{enumerate}
\item \textbf{Detecci√≥n de Sesi√≥n (Middleware):}
    Al intentar acceder a cualquier ruta protegida (ej. \texttt{/dashboard}), el sistema verifica la validez del estado de autenticaci√≥n de PocketBase.
\end{enumerate}
\begin{itemize}
\item \textit{Si es v√°lida:} Permite el acceso a la aplicaci√≥n.
\item \textit{Si es inv√°lida/inexistente:} Redirige al usuario a la ruta p√∫blica de bienvenida.
\end{itemize}
\begin{enumerate}
\item \textbf{Autenticaci√≥n (Login/Registro):}
    El usuario introduce sus credenciales. El cliente JS invoca al m√©todo \texttt{pb.collection('users').authWithPassword()}.
\end{enumerate}
\begin{itemize}
\item PocketBase valida el hash de la contrase√±a (bcrypt).
\item Si es correcto, retorna un token JWT firmado y el objeto \texttt{User}.
\item El cliente guarda el token en el almacenamiento seguro y actualiza el estado global.
\end{itemize}
\begin{enumerate}
\item \textbf{Onboarding (Primer Acceso):}
    Tras el primer login, se presenta el \texttt{OnboardingModal}. Este componente gu√≠a al usuario a trav√©s de 4 pasos clave, explicando c√≥mo usar el chat, el simulador y c√≥mo interpretar su progreso.

\end{enumerate}
\subsection{4.4.2. Flujo de Consulta al Asistente (Chat)}
Este flujo representa el ciclo completo de una interacci√≥n conversacional, desde que el usuario presiona "Enviar" hasta que la respuesta completa se visualiza.

\begin{enumerate}
\item \textbf{Captura y Optimizaci√≥n (Cliente):}
\end{enumerate}
\begin{itemize}
\item El usuario escribe un mensaje. El componente \texttt{ChatArea} bloquea inmediatamente el input.
\item Se a√±ade el mensaje del usuario al estado local de la UI ("Optimistic UI update") para una sensaci√≥n de respuesta instant√°nea.
\end{itemize}
\begin{enumerate}
\item \textbf{Construcci√≥n del Payload (Cliente -> Servidor):}
    Se env√≠a una solicitud POST a \texttt{/api/chat} conteniendo:
\end{enumerate}
\begin{itemize}
\item \texttt{messages}: El historial reciente de la conversaci√≥n.
\item \texttt{mode}: El modo pedag√≥gico actual (ej. \texttt{'socratic'}, \texttt{'workshop'}).
\end{itemize}
\begin{enumerate}
\item \textbf{Orquestaci√≥n de IA (Servidor):}
\end{enumerate}
\begin{itemize}
\item \textbf{Inyecci√≥n de System Prompt:} La API selecciona la "personalidad" de la IA adecuada para el modo solicitado.
\item \textbf{Llamada a Gemini:} Se invoca la API de Google usando \texttt{streaming: true}.
\end{itemize}
\begin{enumerate}
\item \textbf{Streaming y Persistencia (Respuesta):}
\end{enumerate}
\begin{itemize}
\item El servidor transmite los tokens generados al cliente en tiempo real.
\item Una vez finalizada la transmisi√≥n, el cliente env√≠a una petici√≥n as√≠ncrona a PocketBase para guardar el mensaje del usuario y la respuesta completa de la IA en la colecci√≥n \texttt{messages}.

\end{itemize}
\begin{figure}[H]
\centering
% \includegraphics[width=0.8\textwidth]{placeholder.png}
\caption{Diagrama de Secuencia - Interacci√≥n de Chat}
\label{figura\_4.3}
\end{figure}
\textit{\textit{Sugerencia: Diagrama UML de secuencia detallado mostrando: Usuario -> Chat UI -> Next.js API (LangChain) -> Google Gemini -> PocketBase (Async Save).}}

\subsection{4.4.3. Flujo de Simulaci√≥n de Examen}
El proceso de simulaci√≥n es t√©cnicamente el m√°s riguroso, ya que involucra generaci√≥n procedimental y evaluaci√≥n l√≥gica.

\begin{enumerate}
\item \textbf{Configuraci√≥n del Examen:}
    El usuario define los par√°metros: Cantidad de preguntas (ej. 10, 50, 180) y T√≥pico (ej. "Gesti√≥n de Riesgos").
\item \textbf{Generaci√≥n Procedimental (AI-Driven):}
\end{enumerate}
\begin{itemize}
\item El sistema construye un prompt complejo que incluye la estructura JSON exacta requerida.
\item Gemini retorna el JSON. El backend lo parsea y valida.
\item Se crea un registro en la colecci√≥n \texttt{simulations} con estado \texttt{in\_progress}.
\end{itemize}
\begin{enumerate}
\item \textbf{Ejecuci√≥n del Examen:}
\end{enumerate}
\begin{itemize}
\item Las preguntas se cargan en el \texttt{ExamSimulator}.
\item El usuario responde secuencialmente. Las respuestas se guardan temporalmente en el estado local o se sincronizan peri√≥dicamente.
\end{itemize}
\begin{enumerate}
\item \textbf{Env√≠o y Evaluaci√≥n (Scoring Algorithm):}
\end{enumerate}
\begin{itemize}
\item Al finalizar, se comparan las respuestas del usuario con las correctas.
\item Algoritmo de puntuaci√≥n:
        \texttt{}`typescript
        score = 0
        for (q of questions) \{
           if (userAnswers[q.id] === q.correctAnswer) score++
        \}
        percentage = (score / total) * 100
        \texttt{}`
\end{itemize}
\begin{enumerate}
\item \textbf{Cierre y An√°lisis:}
\end{enumerate}
\begin{itemize}
\item Se actualiza el registro en \texttt{simulations} con el puntaje final y el estado \texttt{completed}.
\item Si el usuario aprueba un nivel (en el contexto de la gamificaci√≥n), se muestra el \texttt{LevelCompletedModal}.

\end{itemize}
\section{4.5. Decisiones de Dise√±o y Justificaci√≥n Tecnol√≥gica}

Esta secci√≥n detalla las decisiones cr√≠ticas de ingenier√≠a y dise√±o tomadas durante el desarrollo del Asistente PMP. Cada decisi√≥n se justifica no solo desde una perspectiva t√©cnica (rendimiento, escalabilidad), sino tambi√©n desde una perspectiva pedag√≥gica.

\subsection{4.5.1. Selecci√≥n del Motor de IA: Google Gemini 3.0 Flash (Preview)}
La elecci√≥n del modelo de lenguaje fundacional (LLM) fue una de las decisiones m√°s trascendentales del proyecto. Se evaluaron opciones como OpenAI GPT-4o y Anthropic Claude 3.5 Sonnet. Finalmente, se seleccion√≥ \textbf{Gemini 3.0 Flash (Preview)} por las siguientes razones t√©cnicas y estrat√©gicas:

\begin{enumerate}
\item \textbf{Ventana de Contexto Masiva (1M+ Tokens):} Permite que el asistente mantenga en memoria todo el historial de conversaciones y documentos de referencia del PMBOK sin sufrir "amnesia".
\item \textbf{Velocidad de Inferencia Superior:} La variante "Flash" est√° optimizada para respuestas de ultra baja latencia. Esto es vital para mantener la "ilusi√≥n de conversaci√≥n" y evitar que el estudiante pierda el foco esperando una respuesta.
\item \textbf{Capacidades de Razonamiento Avanzado:} A pesar de ser un modelo optimizado para velocidad, la versi√≥n 3.0 muestra mejoras significativas en l√≥gica deductiva, crucial para explicar preguntas situacionales complejas del examen PMP.
\item \textbf{Eficiencia de Costos:} Ofrece una relaci√≥n rendimiento/costo superior para tareas educativas de alto volumen en comparaci√≥n con modelos m√°s pesados.

\end{enumerate}
\subsection{4.5.2. Arquitectura de "Prompt Engineering" y Roles Pedag√≥gicos}
En lugar de depender de un √∫nico "System Prompt" gen√©rico, se dise√±√≥ una arquitectura de inyecci√≥n de prompts din√°mica basada en el concepto pedag√≥gico de \textbf{Andamiaje Instruccional}. El sistema cambia su comportamiento interno seg√∫n el "Modo de Estudio":

\begin{itemize}
\item \textbf{Modo Est√°ndar:} Tutor equilibrado, claro y conciso.
\item \textbf{Modo Tutor Socr√°tico:} No da respuestas directas. Responde con preguntas gu√≠a para fomentar el pensamiento cr√≠tico (Nivel de An√°lisis en Bloom).
\item \textbf{Modo Simulador de Examen:} Adopta un tono de "Roleplay" (Stakeholder enojado, Patrocinador exigente) para preparar al estudiante para la presi√≥n emocional y la resoluci√≥n de conflictos en escenarios realistas.
\item \textbf{Modo Workshop (Taller):} Act√∫a como un facilitador experto que gu√≠a al usuario paso a paso en la redacci√≥n de entregables formales (ej. Acta de Constituci√≥n), asegurando que se cumplan los est√°ndares del PMBOK.
\item \textbf{Modo Quiz:} Un examinador estricto que lanza preguntas r√°pidas y directas para evaluar la retenci√≥n de conocimientos espec√≠ficos.

La implementaci√≥n t√©cnica utiliza plantillas de prompts que se ensamblan en tiempo de ejecuci√≥n inyectando variables de contexto, logrando una experiencia altamente personalizada.

\end{itemize}
\subsection{4.5.3. Estrategia de Interfaz de Usuario (UI/UX) para el Aprendizaje Profundo}
La interfaz gr√°fica no es meramente est√©tica; se dise√±√≥ como una herramienta para gestionar la carga cognitiva del estudiante.

\begin{itemize}
\item \textbf{Dise√±o "Distraction-Free":} Se adopt√≥ una filosof√≠a minimalista donde los elementos de navegaci√≥n se aten√∫an durante el estudio profundo.
\item \textbf{Modo Oscuro por Defecto:} Reduce la fatiga visual durante sesiones de estudio nocturnas.
\item \textbf{Feedback Inmediato y Optimista:} Patrones de UI que reaccionan instant√°neamente a las acciones del usuario para mantener el estado de "flow".

\end{itemize}
\subsection{4.5.4. Arquitectura de Datos H√≠brida (Static vs. Dynamic)}
Se dise√±√≥ un modelo de datos h√≠brido que combina la inmutabilidad de los est√°ndares educativos con la flexibilidad del progreso del usuario.

\begin{itemize}
\item \textbf{Contenido Est√°tico en C√≥digo (\texttt{gameData.ts}):} La estructura del PMBOK (Dominios, Tareas, Principios) se codifica directamente en el cliente para garantizar acceso instant√°neo y tipado est√°tico.
\item \textbf{Datos Din√°micos en PocketBase:} Solo los datos generados por el usuario se persisten en la base de datos, separando claramente la l√≥gica de dominio del estado del usuario.

\end{itemize}
\subsection{4.5.5. Enfoque de Gamificaci√≥n Estructural}
La gamificaci√≥n se integr√≥ en el n√∫cleo de la navegaci√≥n.

\begin{itemize}
\item \textbf{Progresi√≥n Bloqueada:} El usuario debe "conquistar" conceptos para desbloquear los siguientes, asegurando una ruta de aprendizaje coherente.
\item \textbf{Sistema de XP y Celebraci√≥n:} Los puntos de experiencia y las modales de "Nivel Completado" (\texttt{LevelCompletedModal}) utilizan recompensas visuales (confeti) para motivar al usuario a completar sus objetivos diarios.

\end{itemize}
\section{4.6. Consideraciones de Seguridad y Robustez}

La seguridad en el desarrollo de software educativo garantiza la integridad del proceso de aprendizaje.

\subsection{4.6.1. Gesti√≥n Segura de Credenciales}
Las claves API sensibles (\texttt{GOOGLE\_API\_KEY}) se almacenan en variables de entorno del lado del servidor, nunca expuestas al cliente. Next.js garantiza este aislamiento por dise√±o.

\subsection{4.6.2. Validaci√≥n de Datos y Prevenci√≥n de Inyecciones}
\begin{itemize}
\item \textbf{Validaci√≥n de Esquema:} Todas las entradas a los API Endpoints se validan rigurosamente (aunque el c√≥digo actual utiliza validaci√≥n manual y tipos TypeScript, la arquitectura est√° preparada para esquemas Zod).
\item \textbf{Sanitizaci√≥n:} Se verifica la estructura de los JSON generados por la IA antes de renderizarlos.

\end{itemize}
\subsection{4.6.3. Aislamiento de Datos Multi-Inquilino (Row Level Security)}
Se implementa RLS en PocketBase:
\begin{itemize}
\item \texttt{user\_id = @request.auth.id}: Regla inmutable que asegura que cada estudiante solo acceda a sus propios datos, independientemente de la l√≥gica del frontend.

\end{itemize}
\subsection{4.6.4. Privacidad}
El sistema minimiza la recolecci√≥n de datos, almacenando solo lo necesario para la continuidad pedag√≥gica y el seguimiento del progreso.